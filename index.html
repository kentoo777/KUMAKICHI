<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éå»æ”¹å¤‰è‹±èªãƒ‰ãƒªãƒ« - Episode 1</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .episode-header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .episode-title {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .episode-subtitle {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .memory-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            position: relative;
            overflow: hidden;
        }

        .memory-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(45deg, #ff6b6b, #feca57, #48dbfb, #ff9ff3);
        }

        .memory-trigger {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 5px solid #ff6b6b;
        }

        .memory-trigger h3 {
            color: #d63031;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .scenario {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #74b9ff;
        }

        .scenario-time {
            font-weight: bold;
            color: #636e72;
            margin-bottom: 10px;
        }

        .dialogue-box {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border-left: 3px solid #00b894;
        }

        .speaker {
            font-weight: bold;
            color: #00b894;
            margin-bottom: 5px;
        }

        .your-response {
            background: #ffeaa7;
            border-left-color: #fdcb6e;
            animation: shake 0.5s ease-in-out;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-2px); }
            75% { transform: translateX(2px); }
        }

        .regret-section {
            background: linear-gradient(135deg, #fd79a8 0%, #fdcb6e 100%);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .regret-section h4 {
            color: #2d3436;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .solution-card {
            background: linear-gradient(135deg, #00b894 0%, #55efc4 100%);
            color: white;
            border-radius: 10px;
            padding: 25px;
            margin: 20px 0;
        }

        .solution-card h4 {
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .correct-answer {
            background: rgba(255,255,255,0.2);
            border-radius: 8px;
            padding: 15px;
            font-size: 1.1em;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .practice-section {
            background: #6c5ce7;
            color: white;
            border-radius: 10px;
            padding: 25px;
            margin-top: 20px;
        }

        .practice-input {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            margin: 10px 0;
        }

        .check-btn {
            background: #00b894;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .check-btn:hover {
            background: #00a085;
            transform: translateY(-2px);
        }

        .tips-box {
            background: #74b9ff;
            color: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 15px;
        }

        .emoji {
            font-size: 1.5em;
            margin-right: 10px;
        }

        .highlight {
            background: #ffeaa7;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: bold;
        }

        .fade-in {
            animation: fadeIn 1s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="episode-header fade-in">
            <h1 class="episode-title">ğŸ¬ éå»æ”¹å¤‰è‹±èªãƒ‰ãƒªãƒ«</h1>
            <p class="episode-subtitle">Episode 1: ã‚ã®æ™‚ã®æ²ˆé»™ã‚’æ•‘ãˆ</p>
        </div>

        <div class="memory-card fade-in">
            <div class="memory-trigger">
                <h3><span class="emoji">ğŸ’­</span>è¨˜æ†¶ã‚’å‘¼ã³èµ·ã“ã—ã¦ãã ã•ã„...</h3>
                <p>ã‚ãªãŸã¯ä¸­å­¦2å¹´ç”Ÿã§ã—ãŸã€‚ã„ã¤ã‚‚ã®ã‚ˆã†ã«è‹±èªã®æˆæ¥­ãŒå§‹ã¾ã‚ã†ã¨ã—ã¦ã„ãŸæ™‚ã®ã“ã¨ã§ã™ã€‚</p>
            </div>

            <div class="scenario">
                <div class="scenario-time">ğŸ“… 2014å¹´4æœˆã€æ°´æ›œæ—¥ã®3æ™‚é–“ç›®</div>
                <p>ALTã®ãƒã‚¤ã‚¯å…ˆç”ŸãŒæ•™å®¤ã«å…¥ã£ã¦ãã¾ã—ãŸã€‚ã„ã¤ã‚‚ã®ã‚ˆã†ã«æ˜ã‚‹ã„ç¬‘é¡”ã§ç”Ÿå¾’ãŸã¡ã‚’è¦‹å›ã—ã¦ã„ã¾ã™ã€‚</p>
                <p>ãã—ã¦çªç„¶ã€ã‚ãªãŸã®æ–¹ã‚’å‘ã„ã¦æ­©ã„ã¦ãã¾ã—ãŸ...</p>
                
                <div class="dialogue-box">
                    <div class="speaker">ğŸ‘¨â€ğŸ« ãƒã‚¤ã‚¯å…ˆç”Ÿ:</div>
                    <div>"Hey! How was your weekend?"</div>
                </div>

                <div class="dialogue-box your-response">
                    <div class="speaker">ğŸ˜° ã‚ãªãŸ:</div>
                    <div>"Good..." <span class="highlight">(3ç§’ã®æ²ˆé»™)</span> "...weekend."</div>
                </div>

                <div class="dialogue-box">
                    <div class="speaker">ğŸ‘¨â€ğŸ« ãƒã‚¤ã‚¯å…ˆç”Ÿ:</div>
                    <div>"Oh... okay!" <span style="opacity: 0.7;">(å°‘ã—å›°æƒ‘æ°—å‘³)</span></div>
                </div>
            </div>

            <div class="regret-section">
                <h4>ğŸ’” ã‚ã®æ™‚ã®ã‚‚ã©ã‹ã—ã•ã€è¦šãˆã¦ã„ã¾ã›ã‚“ã‹ï¼Ÿ</h4>
                <p>é ­ã®ä¸­ã§ã¯è‰²ã€…è¨€ã„ãŸã„ã“ã¨ãŒã‚ã£ãŸã®ã«...<br>
                æ˜ ç”»ã‚’è¦‹ã«è¡Œã£ãŸã“ã¨ã€å‹é”ã¨éŠã‚“ã ã“ã¨ã€æ¥½ã—ã‹ã£ãŸã“ã¨ã€‚<br>
                ã§ã‚‚è‹±èªã«ã§ããªã„ã€‚ã‚ã®3ç§’é–“ã®æ²ˆé»™ã®é‡ã•ã‚’ã€‚</p>
            </div>

            <div class="solution-card">
                <h4><span class="emoji">âœ¨</span>ã‚‚ã—ã‚ã®æ™‚ã€ã“ã‚Œã‚’çŸ¥ã£ã¦ã„ãŸã‚‰</h4>
                <div class="correct-answer">
                    "It was great! I went to the movies with my friends and had a lot of fun!"
                </div>
                <p><strong>è§£èª¬:</strong> ã€ŒGoodã€ã ã‘ã§ãªãã€å…·ä½“çš„ãªæ´»å‹•ã‚’åŠ ãˆã‚‹ã“ã¨ã§è‡ªç„¶ãªä¼šè©±ã«ãªã‚Šã¾ã™ã€‚<br>
                "It was great" â†’ æ„Ÿæƒ³ã‚’è¿°ã¹ã‚‹<br>
                "I went to..." â†’ å…·ä½“çš„ãªè¡Œå‹•<br>
                "and had a lot of fun" â†’ æ„Ÿæƒ…ã‚’ä»˜ã‘åŠ ãˆã‚‹</p>
            </div>

            <div class="practice-section">
                <h4><span class="emoji">ğŸ¯</span>ä»Šã®ã‚ãªãŸãªã‚‰æ•‘ãˆã‚‹ã¯ãš</h4>
                <p>åŒã˜å ´é¢ã§ã€ã‚ãªãŸãªã‚‰ãªã‚“ã¦ç­”ãˆã¾ã™ã‹ï¼Ÿ<br>
                ã‚ã®æ™‚ã®è‡ªåˆ†ã‚’æ•‘ã£ã¦ã‚ã’ã¾ã—ã‚‡ã†ã€‚</p>
                
                <input type="text" class="practice-input" placeholder="ã‚ãªãŸã®ç­”ãˆã‚’è‹±èªã§å…¥åŠ›ã—ã¦ãã ã•ã„..." id="userAnswer">
                <br>
                <button class="check-btn" onclick="checkAnswer()">ç­”ãˆã‚’ãƒã‚§ãƒƒã‚¯</button>
                
                <div id="feedback" style="margin-top: 15px; display: none;"></div>
            </div>

            <div class="tips-box">
                <h4><span class="emoji">ğŸ’¡</span>ãƒã‚¤ãƒ†ã‚£ãƒ–ã£ã½ãèã“ãˆã‚‹ã‚³ãƒ„</h4>
                <ul>
                    <li>æ„Ÿæƒ³ + å…·ä½“çš„è¡Œå‹• + æ„Ÿæƒ…ã§3æ®µæ§‹ãˆ</li>
                    <li>"Good" ã‚ˆã‚Š "Great" "Awesome" "Pretty good" ã®æ–¹ãŒè‡ªç„¶</li>
                    <li>éå»å½¢ã‚’ã‚µãƒ©ãƒƒã¨ä½¿ãˆã‚‹ã¨ã‚«ãƒƒã‚³ã„ã„</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        async function checkAnswer() {
            const userAnswer = document.getElementById('userAnswer').value.trim();
            const feedback = document.getElementById('feedback');
            const checkBtn = document.querySelector('.check-btn');
            
            if (userAnswer === '') {
                feedback.innerHTML = '<p style="color: #ff6b6b;">ç­”ãˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼</p>';
                feedback.style.display = 'block';
                return;
            }

            // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
            checkBtn.disabled = true;
            checkBtn.textContent = 'æ·»å‰Šä¸­...';
            feedback.innerHTML = `
                <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 8px; text-align: center;">
                    <div style="display: inline-block; width: 20px; height: 20px; border: 3px solid #ffffff; border-top: 3px solid transparent; border-radius: 50%; animation: spin 1s linear infinite; margin-right: 10px;"></div>
                    <span>AIå…ˆç”ŸãŒæ·»å‰Šä¸­ã§ã™...</span>
                </div>
            `;
            feedback.style.display = 'block';

            // å³åº§ã«APIå‘¼ã³å‡ºã—é–‹å§‹
            let correctionPromise;
            try {
                correctionPromise = getCorrectionFromAPI(userAnswer);
            } catch (error) {
                correctionPromise = Promise.resolve(getFallbackCorrection(userAnswer));
            }

            // APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å–å¾—ï¼ˆ0.2ç§’ç¨‹åº¦ã§å®Œäº†ï¼‰
            const correction = await correctionPromise;

            // ã§ã‚‚ç”»é¢ã«ã¯2ç§’å¾Œã«è¡¨ç¤ºï¼ˆæ¼”å‡ºã®ãŸã‚ï¼‰
            setTimeout(() => {
                displayCorrection(correction, userAnswer);
                checkBtn.disabled = false;
                checkBtn.textContent = 'ç­”ãˆã‚’ãƒã‚§ãƒƒã‚¯';
            }, 2000);
        }

        async function getCorrectionFromAPI(userAnswer) {
            // å®Ÿéš›ã®APIå‘¼ã³å‡ºã—
            try {
                const response = await fetch('https://kumakichi.vercel.app/api/correct', {
                    method: 'POST',
                    headers: {
                   ã€€ã€€ 'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: "gpt-4o-mini", // å®‰ã„ãƒ¢ãƒ‡ãƒ«ã§OK
                        messages: [{
                            role: "user", 
                            content: `ä»¥ä¸‹ã®è‹±èªã‚’æ·»å‰Šã—ã¦ãã ã•ã„ã€‚æ—¥æœ¬èªã§å›ç­”ã—ã€JSONå½¢å¼ã§è¿”ã—ã¦ãã ã•ã„ï¼š

"${userAnswer}"

å¿…è¦ãªé …ç›®ï¼š
- score: 0-100ã®æ•°å€¤
- grammar: æ–‡æ³•ä¸Šã®å•é¡Œç‚¹ã®é…åˆ—ï¼ˆå•é¡Œãªã‘ã‚Œã°ç©ºé…åˆ—ï¼‰
- naturalness: "ã¨ã¦ã‚‚è‡ªç„¶" | "è‡ªç„¶" | "ã‚„ã‚„ä¸è‡ªç„¶"
- suggestions: æ”¹å–„ææ¡ˆã®é…åˆ—
- nativeVersion: ãƒã‚¤ãƒ†ã‚£ãƒ–ãªã‚‰ã“ã†è¨€ã†ã¨ã„ã†ä¾‹æ–‡

JSONå½¢å¼ä¾‹ï¼š
{
  "score": 85,
  "grammar": ["éå»å½¢ã‚’ä½¿ã„ã¾ã—ã‚‡ã†"],
  "naturalness": "è‡ªç„¶",
  "suggestions": ["å…·ä½“çš„ãªæ´»å‹•ã‚’è¿½åŠ ã—ã¦ã¿ã¾ã—ã‚‡ã†"],
  "nativeVersion": "It was awesome! I went to the movies with friends."
}`
                        }],
                        temperature: 0.7,
                        max_tokens: 500
                    })
                });

                if (!response.ok) {
                    throw new Error('APIå‘¼ã³å‡ºã—ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }

                const data = await response.json();
                const content = data.choices[0].message.content;
                
                // JSONã‚’æŠ½å‡ºï¼ˆ```json ã§å›²ã¾ã‚Œã¦ã„ã‚‹å ´åˆãŒã‚ã‚‹ãŸã‚ï¼‰
                const jsonMatch = content.match(/\{[\s\S]*\}/);
                if (jsonMatch) {
                    return JSON.parse(jsonMatch[0]);
                } else {
                    throw new Error('JSONå½¢å¼ã§ãªã„å¿œç­”');
                }
                
            } catch (error) {
                console.error('API Error:', error);
                // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã«åˆ‡ã‚Šæ›¿ãˆ
                return mockAPIResponse(userAnswer);
            }
        }

        function mockAPIResponse(userAnswer) {
            // å®Ÿéš›ã®APIã£ã½ã„è©³ç´°ãªæ·»å‰Šçµæœã‚’ç”Ÿæˆ
            const score = calculateScore(userAnswer);
            const grammarIssues = checkGrammar(userAnswer);
            const suggestions = generateSuggestions(userAnswer);
            
            return {
                score: score,
                grammar: grammarIssues,
                naturalness: getNaturalnessLevel(userAnswer),
                suggestions: suggestions,
                nativeVersion: generateNativeVersion(userAnswer)
            };
        }

        function calculateScore(text) {
            let score = 50; // ãƒ™ãƒ¼ã‚¹ã‚¹ã‚³ã‚¢
            
            // èªå½™ã®è±Šå¯Œã•
            if (text.toLowerCase().includes('great') || text.toLowerCase().includes('awesome')) score += 15;
            if (text.toLowerCase().includes('wonderful') || text.toLowerCase().includes('fantastic')) score += 20;
            
            // æ–‡æ³•ã®æ­£ç¢ºæ€§
            if (text.includes('went') || text.includes('had') || text.includes('was')) score += 20;
            
            // å…·ä½“æ€§
            if (text.includes('movie') || text.includes('friend') || text.includes('shopping')) score += 15;
            
            return Math.min(score, 100);
        }

        function checkGrammar(text) {
            const issues = [];
            
            if (text.includes('go to') && !text.includes('went to')) {
                issues.push("ã€Œgoã€ã¯éå»ã®è©±ãªã®ã§ã€Œwentã€ã«å¤‰æ›´ã—ã¾ã—ã‚‡ã†");
            }
            
            if (text.toLowerCase().includes('very good')) {
                issues.push("ã€Œvery goodã€ã‚ˆã‚Šã€Œgreatã€ã€Œawesomeã€ã®æ–¹ãŒè‡ªç„¶ã§ã™");
            }
            
            if (!text.includes('.') && !text.includes('!')) {
                issues.push("æ–‡æœ«ã«å¥èª­ç‚¹ã‚’ä»˜ã‘ã‚‹ã¨ã‚ˆã‚Šè‰¯ã„ã§ã—ã‚‡ã†");
            }
            
            return issues;
        }

        function generateSuggestions(text) {
            const suggestions = [];
            
            if (!text.toLowerCase().includes('friend') && !text.toLowerCase().includes('family')) {
                suggestions.push("ã€Œèª°ã¨ã€éã”ã—ãŸã‹ã‚’è¿½åŠ ã™ã‚‹ã¨ä¼šè©±ãŒå¼¾ã¿ã¾ã™");
            }
            
            if (!text.toLowerCase().includes('fun') && !text.toLowerCase().includes('enjoy')) {
                suggestions.push("æ„Ÿæƒ³ã‚’è¡¨ã™è¨€è‘‰ï¼ˆfun, enjoyable ãªã©ï¼‰ã‚’åŠ ãˆã¾ã—ã‚‡ã†");
            }
            
            suggestions.push("å…·ä½“çš„ãªæ´»å‹•ã‚’1ã¤è¿½åŠ ã™ã‚‹ã¨ã€ã‚ˆã‚Šèˆˆå‘³æ·±ã„å›ç­”ã«ãªã‚Šã¾ã™");
            
            return suggestions;
        }

        function generateNativeVersion(text) {
            // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å›ç­”ã«åŸºã¥ã„ã¦ãƒã‚¤ãƒ†ã‚£ãƒ–ã£ã½ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ç”Ÿæˆ
            if (text.toLowerCase().includes('movie')) {
                return "It was awesome! I caught a movie with my friends and we had a blast!";
            } else if (text.toLowerCase().includes('shopping')) {
                return "Pretty great! I went shopping and found some cool stuff.";
            } else {
                return "It was fantastic! I hung out with friends and had such a good time.";
            }
        }

        function getNaturalnessLevel(text) {
            if (text.toLowerCase().includes('awesome') || text.toLowerCase().includes('fantastic')) {
                return "ã¨ã¦ã‚‚è‡ªç„¶";
            } else if (text.toLowerCase().includes('great') || text.toLowerCase().includes('fun')) {
                return "è‡ªç„¶";
            } else {
                return "ã‚„ã‚„ä¸è‡ªç„¶";
            }
        }

        function displayCorrection(correction, userAnswer) {
            const feedback = document.getElementById('feedback');
            
            const scoreColor = correction.score >= 80 ? '#00b894' : correction.score >= 60 ? '#f39c12' : '#e74c3c';
            
            feedback.innerHTML = `
                <div style="background: rgba(255,255,255,0.95); padding: 25px; border-radius: 12px; color: #2d3436;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h5 style="color: #2d3436; margin: 0;">ğŸ¤– AIå…ˆç”Ÿã®æ·»å‰Šçµæœ</h5>
                        <div style="background: ${scoreColor}; color: white; padding: 5px 15px; border-radius: 20px; font-weight: bold;">
                            ${correction.score}/100ç‚¹
                        </div>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <strong>ğŸ“ ã‚ãªãŸã®å›ç­”:</strong><br>
                        "${userAnswer}"
                    </div>
                    
                    ${correction.grammar.length > 0 ? `
                    <div style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; margin-bottom: 15px; border-radius: 0 8px 8px 0;">
                        <strong>âš ï¸ æ–‡æ³•ãƒã‚§ãƒƒã‚¯:</strong>
                        <ul style="margin: 10px 0 0 20px;">
                            ${correction.grammar.map(issue => `<li>${issue}</li>`).join('')}
                        </ul>
                    </div>
                    ` : ''}
                    
                    <div style="background: #d1ecf1; border-left: 4px solid #17a2b8; padding: 15px; margin-bottom: 15px; border-radius: 0 8px 8px 0;">
                        <strong>ğŸŒŸ è‡ªç„¶ã•:</strong> ${correction.naturalness}
                    </div>
                    
                    <div style="background: #d4edda; border-left: 4px solid #28a745; padding: 15px; margin-bottom: 15px; border-radius: 0 8px 8px 0;">
                        <strong>ğŸ’¡ æ”¹å–„ææ¡ˆ:</strong>
                        <ul style="margin: 10px 0 0 20px;">
                            ${correction.suggestions.map(suggestion => `<li>${suggestion}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <div style="background: #e7f3ff; border-left: 4px solid #007bff; padding: 15px; border-radius: 0 8px 8px 0;">
                        <strong>ğŸ¯ ãƒã‚¤ãƒ†ã‚£ãƒ–ãªã‚‰ã“ã†è¨€ã†:</strong><br>
                        <em style="font-size: 1.1em; color: #007bff;">"${correction.nativeVersion}"</em>
                    </div>
                </div>
            `;
        }

        function getFallbackCorrection(userAnswer) {
            // APIå¤±æ•—æ™‚ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
            return {
                score: 75,
                grammar: ["ç´ æ™´ã‚‰ã—ã„å›ç­”ã§ã™ï¼"],
                naturalness: "è‡ªç„¶",
                suggestions: ["ã‚ˆã‚Šå…·ä½“çš„ãªè©³ç´°ã‚’åŠ ãˆã‚‹ã¨å®Œç’§ã§ã™"],
                nativeVersion: "It was great! I had an amazing weekend!"
            };
        }

        // ã‚¨ãƒ³ã‚¿ãƒ¼ã‚­ãƒ¼ã§ã‚‚é€ä¿¡å¯èƒ½ã«
        document.getElementById('userAnswer').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                checkAnswer();
            }
        });
    </script>
</body>
</html>
